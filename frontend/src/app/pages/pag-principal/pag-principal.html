<app-nav-bar (searchChanged)="filtrarProductos($event)"  [mensajeExterno]="mensajeToast" ></app-nav-bar>
<div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-15">

    <h2 class="text-2xl font-semibold mb-8">Nuestro CatÃ¡logo</h2>

    <!-- GRID -->
    <div *ngIf="productosFiltrados.length > 0; else noProductos" 
         class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">

        <!-- PRODUCTO -->
        <div *ngFor="let p of productosFiltrados"
            class="rounded-xl overflow-hidden cursor-pointer shadow border border-gray-200 bg-white flex flex-col group relative">

            <!-- IMAGEN GRANDE con hover -->
            <div class="h-[320px] sm:h-[360px] md:h-[420px] bg-gray-100 overflow-hidden relative">

                <!-- Imagen -->
                <img [src]="obtenerImagen(p)" alt="{{ p.nombre }}"
                    class="w-full h-full object-cover sm:object-contain md:object-cover transform transition-transform duration-300 group-hover:scale-110" />

                <!-- Ãcono de ojo -->
                <div
                    class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-black/30">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 text-white" fill="currentColor"
                        viewBox="0 0 24 24">
                        <path
                            d="M12 5c-7.633 0-11 7-11 7s3.367 7 11 7 11-7 11-7-3.367-7-11-7zm0 12c-2.761 0-5-2.239-5-5s2.239-5 5-5 5 2.239 5 5-2.239 5-5 5zm0-8.5c-1.93 0-3.5 1.57-3.5 3.5s1.57 3.5 3.5 3.5 3.5-1.57 3.5-3.5-1.57-3.5-3.5-3.5z" />
                    </svg>
                </div>

            </div>

            <!-- INFO -->
            <div class="p-5 flex flex-col">

                <p class="text-gray-500 text-sm">{{ p.categoria?.nombre }}</p>

                <h3 class="text-lg mt-1 font-semibold">
                    {{ p.nombre }}
                </h3>

                <p class="text-gray-900 text-lg mt-2 font-bold">
                    {{ p.precio_venta_formateado  }} COP
                </p>

                <p class="text-sm text-gray-600 mt-1">
                    Stock: {{ p.stock || 0 }}
                </p>

                <!-- BOTÃ“N O PRODUCTO NO DISPONIBLE -->
                <div class="mt-4">
                    <button (click)="agregarAlCarrito(p)" class="bg-[#030213] text-white px-4 py-2 rounded-lg hover:bg-gray-900 w-full">
                        Agregar al carrito ðŸ›’
                    </button>

                    <div *ngIf="p.estado === 'inactivo'"
                        class="w-full py-2 rounded-lg bg-gray-300 text-center text-gray-700 flex items-center justify-center gap-2 cursor-not-allowed">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-600" fill="currentColor"
                            viewBox="0 0 24 24">
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z" />
                        </svg>
                        Producto no disponible
                    </div>
                </div>

            </div>

        </div>

    </div>

    <!-- MENSAJE CUANDO NO HAY PRODUCTOS -->
    <ng-template #noProductos>
        <div class="text-center text-gray-500 py-20 text-lg font-semibold">
            No se encontraron productos
        </div>
    </ng-template>

</div>

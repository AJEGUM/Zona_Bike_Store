<div class="px-4 sm:px-10 lg:px-20">

  <!-- ENCABEZADO -->
  <div class="flex items-center mt-6 mb-4">
    <h1 class="text-lg sm:text-xl text-white font-semibold">
      Gestión de usuarios
    </h1>

    <button
      (click)="abrirModalCrear()"
      class="ml-auto text-xs sm:text-sm bg-white text-black px-3 sm:px-4 py-2
             font-medium rounded-lg flex items-center gap-2 shadow hover:bg-gray-100">

      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 sm:w-5 sm:h-5"
        viewBox="0 -960 960 960" fill="currentColor">
        <path d="M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z"/>
      </svg>
      Nuevo usuario
    </button>
  </div>

  <div class="overflow-x-auto rounded-xl shadow">
    <table class="min-w-[700px] w-full text-sm text-left bg-white rounded-xl">
      <thead>
        <tr class="bg-white border-b border-gray-300">
          <th class="px-4 py-3 font-semibold max-w-[180px] truncate">Nombre</th>
          <th class="px-4 py-3 font-semibold max-w-[220px] truncate">Email</th>
          <th class="px-4 py-3 font-semibold max-w-[150px] truncate">Rol</th>
          <th class="px-4 py-3 font-semibold text-center max-w-[120px] truncate">Acciones</th>
        </tr>
      </thead>

      <tbody class="divide-y divide-gray-200">
        <tr *ngFor="let u of usuarios" class="hover:bg-gray-50">

          <td class="px-4 py-3 max-w-[180px] truncate">{{ u.nombre }}</td>

          <td class="px-4 py-3 max-w-[220px] truncate">{{ u.email }}</td>

          <td class="px-4 py-3 max-w-[150px] truncate">
            <span class="px-2 py-1 rounded-md text-xs font-semibold"
              [ngClass]="{
                'bg-gray-100': u.rol === 'Cliente',
                'bg-black text-white': u.rol === 'Administrador'
              }">
              {{ u.rol }}
            </span>
          </td>

          <td class="px-4 py-3 text-center max-w-[120px] truncate">
            <button (click)="abrirModalEditar(u)" class="cursor-pointer px-5" title="Editar">
              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                fill="#000000">
                <path
                  d="M205-205h53l392-391.5-53.5-53.5L205-257.5v52.5Zm-75 75v-159l520-519.5q10.98-10.28 24.24-15.89Q687.5-830 702.47-830t29 5.75q14.03 5.75 25.03 16.75l52 52.5q11 10.5 16.25 24.25t5.25 28.02q0 15.23-5.14 28.67-5.14 13.44-16.36 24.56L289-130H130Zm625-572.5L702.5-755l52.5 52.5ZM623-623l-26.5-27 53.5 53.5-27-26.5Z" />
              </svg>
            </button>

            <button (click)="eliminar(u.id_usuario!)" class="cursor-pointer" title="Eliminar">
              <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                fill="#EA3323">
                <path
                  d="M283-130q-30.94 0-52.97-22.03Q208-174.06 208-205v-512h-39v-75h193v-38h237v38h193v75h-39v512q0 30.94-22.03 52.97Q708.94-130 678-130H283Zm395-587H283v512h395v-512ZM365-283.5h75v-355h-75v355Zm156 0h75v-355h-75v355ZM283-717v512-512Z" />
              </svg>
            </button>
          </td>

        </tr>
      </tbody>
    </table>
  </div>
</div>


<!-- MODAL -->
<div *ngIf="modalAbierto" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white w-full max-w-lg rounded-xl shadow-lg p-6 relative">

    <button (click)="cerrarModal()" class="absolute top-3 right-3 text-gray-500 hover:text-black">✕</button>

    <h2 class="text-xl font-semibold mb-4">
      {{ editando ? 'Editar usuario' : 'Nuevo usuario' }}
    </h2>

    <form (ngSubmit)="guardar()" class="space-y-4">

      <div>
        <label class="font-medium">Nombre</label>
        <input type="text" [(ngModel)]="form.nombre" name="nombre" (keypress)="soloLetras($event)" class="w-full border px-3 py-2 rounded-lg" required>
      </div>

      <div>
        <label class="font-medium">Email</label>
        <input type="email" [(ngModel)]="form.email" name="email"
              class="w-full border px-3 py-2 rounded-lg"
              (ngModelChange)="validarEmail()"
              (keypress)="soloPermitidos($event)" required>

        <p *ngIf="emailError" class="text-red-500 text-sm mt-1">{{ emailError }}</p>
      </div>


      <div>
        <label class="font-medium">Clave</label>
        <input type="password" [(ngModel)]="form.clave" name="clave"
              class="w-full border px-3 py-2 rounded-lg"
              [required]="!editando"
              placeholder="{{ editando ? 'Dejar vacío para no cambiar' : '' }}"
              (ngModelChange)="validarClaveVisual()">

        <p *ngIf="claveError" class="text-red-500 text-sm mt-1">{{ claveError }}</p>
      </div>


      <div>
        <label class="font-medium">Rol</label>
        <select [(ngModel)]="form.id_rol" name="rol" class="w-full border px-3 py-2 rounded-lg" required>
          <option value="0" disabled>Seleccionar...</option>
          <option *ngFor="let r of roles" [value]="r.id_rol">
            {{ r.nombre }}
          </option>
        </select>
      </div>

      <div class="flex justify-end gap-3 mt-6">
        <button type="button" (click)="cerrarModal()" class="px-4 py-2 border rounded-lg">Cancelar</button>
        <button type="submit" class="px-4 py-2 bg-[#0B1120] text-white rounded-lg">
          {{ editando ? 'Actualizar' : 'Registrar' }}
        </button>
      </div>

    </form>
  </div>
</div>